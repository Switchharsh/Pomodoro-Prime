<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="A simple, distraction-free Pomodoro timer for focused work sessions">
<meta name="theme-color" content="#2D5A27">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="icon-192.png">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Pomodoro Prime - Forest Focus Timer</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then((registration) => {
          console.log('Service Worker registered:', registration);
        })
        .catch((error) => {
          console.log('Service Worker registration failed:', error);
        });
    });
  }
</script>
</head>
<body>
<!-- Sky Canvas for Day/Night Cycle -->
<canvas id="skyCanvas" class="sky-canvas" aria-hidden="true"></canvas>
<!-- Floating Particles Canvas -->
<canvas id="particlesCanvas" class="particles-canvas" aria-hidden="true"></canvas>
<!-- Celebration Particles Canvas -->
<canvas id="celebrationCanvas" class="celebration-canvas" aria-hidden="true"></canvas>

<div class="container">
  <header class="header">
    <div class="header-top">
      <h1 class="title">ğŸŒ² Pomodoro Prime</h1>
      <div class="header-controls">
        <button class="icon-btn" id="settingsBtn" aria-label="Open settings" aria-expanded="false">
          <span aria-hidden="true">âš™ï¸</span>
        </button>
        <button class="icon-btn" id="shortcutsBtn" aria-label="Show keyboard shortcuts">
          <span aria-hidden="true">âŒ¨ï¸</span>
        </button>
        <button class="icon-btn" id="themeToggle" aria-label="Toggle dark mode">
          <span class="theme-icon" aria-hidden="true">ğŸŒ™</span>
        </button>
      </div>
    </div>
    <p class="subtitle">Stay focused, take breaks, repeat</p>
    
    <!-- XP Level Display -->
    <div class="xp-display">
      <div class="xp-level" id="xpLevel">Level 1: Novice</div>
      <div class="xp-bar-container">
        <div class="xp-bar" id="xpBar"></div>
      </div>
      <div class="xp-text" id="xpText">0/100 XP</div>
    </div>
  </header>

  <main class="main">
    <!-- Timer Display -->
    <section class="timer-section" aria-live="polite">
      <div class="timer-type" id="timerType" role="status">Focus</div>
      
      <div class="timer-display-container">
        <div class="timer-display" id="timerDisplay" aria-label="Time remaining">25:00</div>
        
        <!-- Timer Info -->
        <div class="timer-info">
          <div class="timer-stat">
            <span class="timer-stat-label">Progress</span>
            <span class="timer-stat-value" id="progressPercent">0%</span>
          </div>
          <div class="timer-stat">
            <span class="timer-stat-label">Elapsed</span>
            <span class="timer-stat-value" id="timeElapsed">0:00</span>
          </div>
          <div class="timer-stat">
            <span class="timer-stat-label">Remaining</span>
            <span class="timer-stat-value" id="timeRemaining">25:00</span>
          </div>
        </div>
      </div>

      <div class="timer-progress">
        <div class="progress-ring" id="progressRing">
          <svg class="progress-svg" viewBox="0 0 100 100" role="img" aria-label="Timer progress">
            <!-- Mini sky gradient background inside ring -->
            <defs>
              <linearGradient id="timerSkyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#E0F7FA;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#FFF9C4;stop-opacity:1" />
              </linearGradient>
              <radialGradient id="celestialGlow">
                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.8" />
                <stop offset="100%" style="stop-color:#FFD700;stop-opacity:0" />
              </radialGradient>
            </defs>
            
            <!-- Background circle with sky gradient -->
            <circle class="progress-bg" cx="50" cy="50" r="45" fill="url(#timerSkyGradient)" stroke="none"/>
            
            <!-- Progress ring -->
            <circle class="progress-track" cx="50" cy="50" r="45" fill="none" stroke-width="6"/>
            <circle class="progress-bar" id="progressBar" cx="50" cy="50" r="45" fill="none" stroke-width="6"
              stroke-dasharray="283" stroke-dashoffset="0" stroke-linecap="round"/>
            
            <!-- Celestial Body (Sun/Moon) with glow -->
            <g id="celestialBody" class="celestial-body">
              <circle id="celestialGlowEffect" cx="50" cy="50" r="20" fill="url(#celestialGlow)" opacity="0"/>
              <circle id="celestialCircle" cx="50" cy="50" r="8" fill="#FFD700"/>
            </g>
          </svg>
        </div>
      </div>

      <!-- Cycle Indicator -->
      <div class="cycle-indicator" aria-label="Pomodoro cycle">
        <span id="currentCycle">1/4</span>
        <span class="cycle-dots" aria-hidden="true">
          <span class="cycle-dot active"></span>
          <span class="cycle-dot"></span>
          <span class="cycle-dot"></span>
          <span class="cycle-dot"></span>
        </span>
      </div>

      <!-- Task Input -->
      <div class="task-input">
        <label for="taskInput" class="visually-hidden">Current task</label>
        <input type="text" id="taskInput" placeholder="What are you working on?" maxlength="60" aria-label="Current task">
      </div>

      <!-- Session Notes -->
      <div class="session-notes">
        <label for="sessionNotes" class="notes-label">ğŸ“ Session Notes</label>
        <textarea id="sessionNotes" placeholder="What did you accomplish?" rows="2" aria-label="Session notes"></textarea>
        <button class="btn-small" id="saveNotesBtn" aria-label="Save notes">Save Notes</button>
      </div>

      <!-- Controls -->
      <div class="controls" role="group" aria-label="Timer controls">
        <button class="btn btn-primary" id="startBtn" aria-label="Start timer">
          <span class="btn-icon" aria-hidden="true">â–¶</span>
          <span class="btn-text">Start</span>
        </button>
        <button class="btn btn-secondary" id="resetBtn" aria-label="Reset timer">
          <span class="btn-icon" aria-hidden="true">â†º</span>
          <span class="btn-text">Reset</span>
        </button>
        <button class="btn btn-secondary" id="skipBtn" aria-label="Skip to next mode">
          <span class="btn-icon" aria-hidden="true">â­</span>
          <span class="btn-text">Skip</span>
        </button>
      </div>

      <!-- Mode Toggle -->
      <div class="mode-toggle" role="tablist" aria-label="Timer mode">
        <button class="mode-btn active" data-mode="focus" role="tab" aria-selected="true" aria-label="Focus mode">
          <span class="mode-icon" aria-hidden="true">ğŸŒ³</span>
          <span class="mode-label">Focus</span>
        </button>
        <button class="mode-btn" data-mode="short" role="tab" aria-selected="false" aria-label="Short break mode">
          <span class="mode-icon" aria-hidden="true">ğŸŒ¿</span>
          <span class="mode-label">Short</span>
        </button>
        <button class="mode-btn" data-mode="long" role="tab" aria-selected="false" aria-label="Long break mode">
          <span class="mode-icon" aria-hidden="true">ğŸƒ</span>
          <span class="mode-label">Long</span>
        </button>
      </div>

      <!-- Timer Presets -->
      <div class="presets-container">
        <h3 class="presets-title">Quick Presets</h3>
        <div class="presets-buttons">
          <button class="preset-btn" data-minutes="15" aria-label="Set timer to 15 minutes">15m</button>
          <button class="preset-btn active" data-minutes="25" aria-label="Set timer to 25 minutes">25m</button>
          <button class="preset-btn" data-minutes="45" aria-label="Set timer to 45 minutes">45m</button>
          <button class="preset-btn" data-minutes="60" aria-label="Set timer to 60 minutes">60m</button>
        </div>
        <div class="custom-duration">
          <label for="customMinutes" class="visually-hidden">Custom duration in minutes</label>
          <input type="number" id="customMinutes" min="1" max="120" placeholder="Custom" aria-label="Custom duration in minutes">
          <button class="btn-small" id="customDurationBtn" aria-label="Set custom duration">Set</button>
        </div>
      </div>
    </section>

    <!-- Breathing Exercise Section (shown during breaks) -->
    <section class="breathing-section hidden" id="breathingSection">
      <h2 class="breathing-title">ğŸ§˜ Breathing Exercise</h2>
      <div class="breathing-circle" id="breathingCircle">
        <div class="breathing-text" id="breathingText">Breathe In</div>
      </div>
      <button class="btn-small" id="skipBreathingBtn" aria-label="Skip breathing exercise">Skip</button>
    </section>

    <!-- Task Management -->
    <section class="tasks-section">
      <h2 class="section-title">ğŸ“‹ Tasks</h2>
      <div class="task-input-group">
        <label for="newTaskInput" class="visually-hidden">Add a new task</label>
        <input type="text" id="newTaskInput" placeholder="Add a new task..." maxlength="100" aria-label="New task">
        <div class="task-pomodoro-input">
          <label for="taskPomodoros" class="visually-hidden">Estimated pomodoros</label>
          <input type="number" id="taskPomodoros" min="1" max="10" placeholder="Pomodoros" aria-label="Estimated pomodoros">
        </div>
        <button class="btn-small" id="addTaskBtn" aria-label="Add task">Add</button>
      </div>
      <ul class="task-list" id="taskList" role="list" aria-label="Task list">
        <!-- Tasks dynamically added -->
      </ul>
    </section>

    <!-- Statistics Section -->
    <section class="stats-section">
      <h2 class="stats-title">ğŸ“Š Today's Progress</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="statPomodoros" aria-label="Completed pomodoros">0</div>
          <div class="stat-label">Pomodoros</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="statFocusTime" aria-label="Total focus time">0m</div>
          <div class="stat-label">Focus Time</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="statStreak" aria-label="Day streak">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
      </div>
      
      <!-- Weekly Chart -->
      <div class="chart-container">
        <h3 class="chart-title">Focus Hours This Week</h3>
        <canvas id="weeklyChart" aria-label="Weekly focus hours chart"></canvas>
      </div>
    </section>

    <!-- Achievements Section -->
    <section class="achievements-section">
      <h2 class="achievements-title">ğŸ† Achievements</h2>
      <div class="achievements-grid" id="achievementsGrid">
        <!-- Achievements dynamically added -->
      </div>
    </section>

    <!-- Sound Settings -->
    <section class="sound-section">
      <h2 class="sound-title">ğŸ”” Notification</h2>
      <div class="sound-controls">
        <div class="sound-option">
          <label for="volumeSlider" class="sound-label">Volume</label>
          <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider" aria-label="Notification volume">
        </div>
        <button class="test-sound-btn" id="testSoundBtn" aria-label="Test notification sound">ğŸµ Test Sound</button>
      </div>
      
      <!-- Ambient Soundscapes -->
      <div class="ambient-sounds">
        <h3 class="ambient-title">ğŸµ Ambient Soundscapes</h3>
        <div class="ambient-controls">
          <div class="ambient-slider">
            <label for="whiteNoiseVolume" class="ambient-label">White Noise</label>
            <input type="range" id="whiteNoiseVolume" min="0" max="100" value="0" class="ambient-volume" aria-label="White noise volume">
          </div>
          <div class="ambient-slider">
            <label for="rainVolume" class="ambient-label">Rain</label>
            <input type="range" id="rainVolume" min="0" max="100" value="0" class="ambient-volume" aria-label="Rain volume">
          </div>
          <div class="ambient-slider">
            <label for="cafeVolume" class="ambient-label">Cafe</label>
            <input type="range" id="cafeVolume" min="0" max="100" value="0" class="ambient-volume" aria-label="Cafe volume">
          </div>
          <div class="ambient-slider">
            <label for="lofiVolume" class="ambient-label">Lo-Fi</label>
            <input type="range" id="lofiVolume" min="0" max="100" value="0" class="ambient-volume" aria-label="Lo-Fi volume">
          </div>
        </div>
      </div>
    </section>

    <!-- Theme Settings -->
    <section class="theme-section">
      <h2 class="theme-title">ğŸ¨ Theme</h2>
      <div class="theme-buttons">
        <button class="theme-option active" data-theme="forest" aria-label="Forest theme">
          <span class="theme-emoji" aria-hidden="true">ğŸŒ²</span>
          <span class="theme-name">Forest</span>
        </button>
        <button class="theme-option" data-theme="ocean" aria-label="Ocean theme">
          <span class="theme-emoji" aria-hidden="true">ğŸŒŠ</span>
          <span class="theme-name">Ocean</span>
        </button>
        <button class="theme-option" data-theme="mountain" aria-label="Mountain theme">
          <span class="theme-emoji" aria-hidden="true">ğŸ”ï¸</span>
          <span class="theme-name">Mountain</span>
        </button>
        <button class="theme-option" data-theme="space" aria-label="Space theme">
          <span class="theme-emoji" aria-hidden="true">ğŸŒŒ</span>
          <span class="theme-name">Space</span>
        </button>
      </div>
      <div class="theme-option">
        <label class="toggle-label">
          <input type="checkbox" id="oledToggle" aria-label="Enable OLED black mode">
          <span>OLED Black Mode</span>
        </label>
      </div>
      <div class="theme-option">
        <label class="toggle-label">
          <input type="checkbox" id="highContrastToggle" aria-label="Enable high contrast mode">
          <span>High Contrast</span>
        </label>
      </div>
    </section>

    <!-- Multiplayer Section -->
    <section class="multiplayer-section">
      <h2 class="multiplayer-title">ğŸ‘¥ Co-Working</h2>
      <div class="multiplayer-controls">
        <button class="btn btn-secondary" id="createRoomBtn" aria-label="Create co-working room">
          <span class="btn-icon" aria-hidden="true">ğŸ </span>
          <span class="btn-text">Create Room</span>
        </button>
        <div class="join-room">
          <label for="roomIdInput" class="visually-hidden">Room ID</label>
          <input type="text" id="roomIdInput" placeholder="Enter Room ID" aria-label="Room ID">
          <button class="btn-small" id="joinRoomBtn" aria-label="Join room">Join</button>
        </div>
      </div>
      <div class="room-info hidden" id="roomInfo">
        <p class="room-id-display">Room ID: <span id="currentRoomId"></span></p>
        <button class="btn-small" id="copyRoomIdBtn" aria-label="Copy room ID">ğŸ“‹ Copy Link</button>
        <button class="btn-small" id="leaveRoomBtn" aria-label="Leave room">Leave</button>
      </div>
      <div class="room-members" id="roomMembers">
        <!-- Room members dynamically added -->
      </div>
    </section>

    <!-- Advanced Options (Collapsible) -->
    <section class="options-section">
      <button class="options-toggle" id="optionsToggle" aria-expanded="false" aria-controls="optionsList">
        <span>âš™ï¸ Advanced Options</span>
        <span class="toggle-icon" aria-hidden="true">â–¼</span>
      </button>
      <div class="options-list" id="optionsList" hidden>
        <label class="toggle-label">
          <input type="checkbox" id="autoStartToggle">
          <span>Auto-start next timer</span>
        </label>
        <label class="toggle-label">
          <input type="checkbox" id="skipBreaksToggle">
          <span>Skip breaks</span>
        </label>
        <label class="toggle-label">
          <input type="checkbox" id="tickSoundToggle">
          <span>Tick sound every minute</span>
        </label>
        <label class="toggle-label">
          <input type="checkbox" id="focusModeToggle">
          <span>Focus Mode (hide non-essentials)</span>
        </label>
        <label class="toggle-label">
          <input type="checkbox" id="breathingToggle" checked>
          <span>Show breathing exercises during breaks</span>
        </label>
      </div>
    </section>

    <!-- Quick Tips -->
    <section class="tips-section">
      <h2 class="tips-title">ğŸŒ± Quick Tips</h2>
      <ul class="tips-list">
        <li>Grow one habit at a time</li>
        <li>Nurture your focus zone</li>
        <li>Root out distractions</li>
        <li>Breathe deep like the forest</li>
      </ul>
    </section>
  </main>
</div>

<!-- Onboarding Modal -->
<div class="modal" id="onboardingModal" role="dialog" aria-modal="true" aria-labelledby="onboardingTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="onboardingTitle">Welcome to Pomodoro Prime! ğŸŒ²</h2>
      <button class="modal-close" id="closeOnboarding" aria-label="Close welcome message">âœ•</button>
    </div>
    <div class="modal-body">
      <p class="modal-text">Your journey to focused productivity starts here:</p>
      <div class="onboarding-steps">
        <div class="step">
          <span class="step-number">1</span>
          <p class="step-text">Choose focus time and click <strong>Start</strong></p>
        </div>
        <div class="step">
          <span class="step-number">2</span>
          <p class="step-text">Work until timer ends (watch the sun/moon cycle!)</p>
        </div>
        <div class="step">
          <span class="step-number">3</span>
          <p class="step-text">Take a short break, then repeat</p>
        </div>
        <div class="step">
          <span class="step-number">4</span>
          <p class="step-text">After 4 pomodoros, enjoy a long break!</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="startJourneyBtn">Start My Journey</button>
      </div>
    </div>
  </div>
</div>

<!-- Keyboard Shortcuts Modal -->
<div class="modal" id="shortcutsModal" role="dialog" aria-modal="true" aria-labelledby="shortcutsTitle">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title" id="shortcutsTitle">âŒ¨ï¸ Keyboard Shortcuts</h2>
      <button class="modal-close" id="closeShortcuts" aria-label="Close shortcuts">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="shortcuts-list">
        <div class="shortcut-item">
          <kbd class="key">Space</kbd>
          <span class="shortcut-desc">Start / Pause timer</span>
        </div>
        <div class="shortcut-item">
          <kbd class="key">R</kbd>
          <span class="shortcut-desc">Reset timer</span>
        </div>
        <div class="shortcut-item">
          <kbd class="key">T</kbd>
          <span class="shortcut-desc">Toggle dark mode</span>
        </div>
        <div class="shortcut-item">
          <kbd class="key">S</kbd>
          <span class="shortcut-desc">Skip to next mode</span>
        </div>
        <div class="shortcut-item">
          <kbd class="key">Esc</kbd>
          <span class="shortcut-desc">Close modals</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Achievement Unlocked Modal -->
<div class="modal achievement-modal" id="achievementModal" role="dialog" aria-modal="true" aria-labelledby="achievementTitle">
  <div class="modal-content achievement-content">
    <div class="modal-header">
      <h2 class="modal-title" id="achievementTitle">ğŸ† Achievement Unlocked!</h2>
      <button class="modal-close" id="closeAchievement" aria-label="Close achievement">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="achievement-icon" id="achievementIcon">ğŸŒŸ</div>
      <p class="achievement-name" id="achievementName">First Pomodoro</p>
      <p class="achievement-desc" id="achievementDesc">Complete your first focus session!</p>
      <div class="xp-gain" id="xpGain">+10 XP</div>
    </div>
  </div>
</div>

<script src="script.js"></script>
</body>
</html>
