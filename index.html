<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="description" content="A simple, distraction-free Pomodoro timer for focused work sessions">
<meta name="theme-color" content="#2D5A27">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.json">
<link rel="icon" type="image/png" href="icon-192.png">
<title>Pomodoro Prime - Forest Focus Timer</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then((registration) => console.log('SW registered:', registration))
        .catch((error) => console.log('SW registration failed:', error));
    });
  }
</script>
</head>
<body>
<!-- Sky Canvas -->
<canvas id="skyCanvas" class="sky-canvas" aria-hidden="true"></canvas>
<canvas id="particlesCanvas" class="particles-canvas" aria-hidden="true"></canvas>
<canvas id="celebrationCanvas" class="celebration-canvas" aria-hidden="true"></canvas>

<div class="container">
  <header class="header">
    <div class="header-top">
      <h1 class="title">ğŸŒ² Pomodoro Prime</h1>
      <div class="header-controls">
        <button class="icon-btn" id="settingsBtn" aria-label="Settings">âš™ï¸</button>
        <button class="icon-btn" id="shortcutsBtn" aria-label="Shortcuts">âŒ¨ï¸</button>
        <button class="icon-btn" id="themeToggle" aria-label="Toggle dark mode"><span class="theme-icon">ğŸŒ™</span></button>
      </div>
    </div>
    <p class="subtitle">Stay focused, take breaks, repeat</p>
    
    <div class="xp-display">
      <div class="xp-level" id="xpLevel">Level 1: Novice</div>
      <div class="xp-bar-container"><div class="xp-bar" id="xpBar"></div></div>
      <div class="xp-text" id="xpText">0/100 XP</div>
    </div>
  </header>

  <main class="main">
    <!-- Timer Section -->
    <section class="timer-section">
      <div class="timer-type" id="timerType">Focus</div>
      <div class="timer-display-container">
        <div class="timer-display" id="timerDisplay">25:00</div>
        <div class="timer-info">
          <div class="timer-stat"><span class="timer-stat-label">Progress</span><span class="timer-stat-value" id="progressPercent">0%</span></div>
          <div class="timer-stat"><span class="timer-stat-label">Elapsed</span><span class="timer-stat-value" id="timeElapsed">0:00</span></div>
          <div class="timer-stat"><span class="timer-stat-label">Remaining</span><span class="timer-stat-value" id="timeRemaining">25:00</span></div>
        </div>
      </div>

      <div class="timer-progress">
        <div class="progress-ring" id="progressRing">
          <svg class="progress-svg" viewBox="0 0 100 100">
            <defs>
              <linearGradient id="timerSkyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#E0F7FA;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#FFF9C4;stop-opacity:1" />
              </linearGradient>
              <radialGradient id="celestialGlow">
                <stop offset="0%" style="stop-color:#FFD700;stop-opacity:0.8" />
                <stop offset="100%" style="stop-color:#FFD700;stop-opacity:0" />
              </radialGradient>
            </defs>
            <circle class="progress-bg" cx="50" cy="50" r="45" fill="url(#timerSkyGradient)" stroke="none"/>
            <circle class="progress-track" cx="50" cy="50" r="45" fill="none" stroke-width="6"/>
            <circle class="progress-bar" id="progressBar" cx="50" cy="50" r="45" fill="none" stroke-width="6" stroke-dasharray="283" stroke-dashoffset="0" stroke-linecap="round"/>
            <g id="celestialBody" class="celestial-body">
              <circle id="celestialGlowEffect" cx="50" cy="50" r="20" fill="url(#celestialGlow)" opacity="0"/>
              <circle id="celestialCircle" cx="50" cy="50" r="8" fill="#FFD700"/>
            </g>
          </svg>
        </div>
      </div>

      <div class="cycle-indicator">
        <span id="currentCycle">1/4</span>
        <span class="cycle-dots">
          <span class="cycle-dot active"></span><span class="cycle-dot"></span><span class="cycle-dot"></span><span class="cycle-dot"></span>
        </span>
      </div>

      <div class="task-input">
        <input type="text" id="taskInput" placeholder="What are you working on?" maxlength="60" aria-label="Current task">
      </div>

      <div class="session-notes">
        <label for="sessionNotes" class="notes-label">ğŸ“ Session Notes</label>
        <textarea id="sessionNotes" placeholder="What did you accomplish?" rows="2"></textarea>
        <button class="btn-small" id="saveNotesBtn">Save Notes</button>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="startBtn"><span class="btn-icon">â–¶</span><span class="btn-text">Start</span></button>
        <button class="btn btn-secondary" id="resetBtn"><span class="btn-icon">â†º</span><span class="btn-text">Reset</span></button>
        <button class="btn btn-secondary" id="skipBtn"><span class="btn-icon">â­</span><span class="btn-text">Skip</span></button>
      </div>

      <div class="mode-toggle">
        <button class="mode-btn active" data-mode="focus"><span class="mode-icon">ğŸŒ³</span><span class="mode-label">Focus</span></button>
        <button class="mode-btn" data-mode="short"><span class="mode-icon">ğŸŒ¿</span><span class="mode-label">Short</span></button>
        <button class="mode-btn" data-mode="long"><span class="mode-icon">ğŸƒ</span><span class="mode-label">Long</span></button>
      </div>

      <div class="presets-container">
        <h3 class="presets-title">Quick Presets</h3>
        <div class="presets-buttons">
          <button class="preset-btn" data-minutes="15">15m</button>
          <button class="preset-btn active" data-minutes="25">25m</button>
          <button class="preset-btn" data-minutes="45">45m</button>
          <button class="preset-btn" data-minutes="60">60m</button>
        </div>
        <div class="custom-duration">
          <input type="number" id="customMinutes" min="1" max="120" placeholder="Custom">
          <button class="btn-small" id="customDurationBtn">Set</button>
        </div>
      </div>
    </section>

    <!-- Breathing Section -->
    <section class="breathing-section hidden" id="breathingSection">
      <h2 class="breathing-title">ğŸ§˜ Breathing Exercise</h2>
      <div class="breathing-circle" id="breathingCircle">
        <div class="breathing-text" id="breathingText">Breathe In</div>
      </div>
      <button class="btn-small" id="skipBreathingBtn">Skip</button>
    </section>

    <!-- Tasks Section -->
    <section class="tasks-section">
      <h2 class="section-title">ğŸ“‹ Tasks</h2>
      <div class="task-input-group">
        <input type="text" id="newTaskInput" placeholder="Add a new task..." maxlength="100">
        <div class="task-pomodoro-input">
          <input type="number" id="taskPomodoros" min="1" max="10" placeholder="Est. Pomodoros">
        </div>
        <button class="btn-small" id="addTaskBtn">Add</button>
      </div>
      <ul class="task-list" id="taskList"></ul>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
      <h2 class="stats-title">ğŸ“Š Today's Progress</h2>
      <div class="stats-grid">
        <div class="stat-item"><div class="stat-value" id="statPomodoros">0</div><div class="stat-label">Pomodoros</div></div>
        <div class="stat-item"><div class="stat-value" id="statFocusTime">0m</div><div class="stat-label">Focus Time</div></div>
        <div class="stat-item"><div class="stat-value" id="statStreak">0</div><div class="stat-label">Day Streak</div></div>
      </div>
      <div class="chart-container">
        <h3 class="chart-title">Focus Hours This Week</h3>
        <canvas id="weeklyChart"></canvas>
      </div>
    </section>

    <!-- Achievements Section -->
    <section class="achievements-section">
      <h2 class="achievements-title">ğŸ† Achievements</h2>
      <div class="achievements-grid" id="achievementsGrid"></div>
    </section>

    <!-- Sound Section -->
    <section class="sound-section">
      <h2 class="sound-title">ğŸ”” Notification</h2>
      <div class="sound-controls">
        <div class="sound-option">
          <label for="volumeSlider" class="sound-label">Volume</label>
          <input type="range" id="volumeSlider" min="0" max="100" value="50" class="volume-slider">
        </div>
        <button class="test-sound-btn" id="testSoundBtn">ğŸµ Test Sound</button>
      </div>
      
      <div class="ambient-sounds">
        <h3 class="ambient-title">ğŸµ Ambient Soundscapes</h3>
        <div class="ambient-controls">
          <div class="ambient-slider">
            <label for="whiteNoiseVolume" class="ambient-label">White Noise</label>
            <input type="range" id="whiteNoiseVolume" min="0" max="100" value="0" class="ambient-volume">
          </div>
          <div class="ambient-slider">
            <label for="rainVolume" class="ambient-label">Rain</label>
            <input type="range" id="rainVolume" min="0" max="100" value="0" class="ambient-volume">
          </div>
        </div>
      </div>
    </section>

    <!-- Theme Section -->
    <section class="theme-section">
      <h2 class="theme-title">ğŸ¨ Theme</h2>
      <div class="theme-buttons">
        <button class="theme-option active" data-theme="forest"><span class="theme-emoji">ğŸŒ²</span><span class="theme-name">Forest</span></button>
        <button class="theme-option" data-theme="ocean"><span class="theme-emoji">ğŸŒŠ</span><span class="theme-name">Ocean</span></button>
        <button class="theme-option" data-theme="mountain"><span class="theme-emoji">ğŸ”ï¸</span><span class="theme-name">Mountain</span></button>
        <button class="theme-option" data-theme="space"><span class="theme-emoji">ğŸŒŒ</span><span class="theme-name">Space</span></button>
      </div>
      <div class="theme-option">
        <label class="toggle-label"><input type="checkbox" id="oledToggle"><span>OLED Black Mode</span></label>
      </div>
      <div class="theme-option">
        <label class="toggle-label"><input type="checkbox" id="highContrastToggle"><span>High Contrast</span></label>
      </div>
    </section>

    <!-- Multiplayer Section -->
    <section class="multiplayer-section">
      <h2 class="multiplayer-title">ğŸ‘¥ Co-Working</h2>
      <div class="multiplayer-controls">
        <button class="btn btn-secondary" id="createRoomBtn"><span class="btn-icon">ğŸ </span><span class="btn-text">Create Room</span></button>
        <div class="join-room">
          <input type="text" id="roomIdInput" placeholder="Enter Room ID">
          <button class="btn-small" id="joinRoomBtn">Join</button>
        </div>
      </div>
      <div class="room-info hidden" id="roomInfo">
        <p class="room-id-display">Room ID: <span id="currentRoomId"></span></p>
        <button class="btn-small" id="copyRoomIdBtn">ğŸ“‹ Copy Link</button>
        <button class="btn-small" id="leaveRoomBtn">Leave</button>
      </div>
      <div class="room-members" id="roomMembers"></div>
    </section>

    <!-- Options Section -->
    <section class="options-section">
      <button class="options-toggle" id="optionsToggle" aria-expanded="false" aria-controls="optionsList">
        <span>âš™ï¸ Advanced Options</span><span class="toggle-icon">â–¼</span>
      </button>
      <div class="options-list" id="optionsList" hidden>
        <label class="toggle-label"><input type="checkbox" id="autoStartToggle"><span>Auto-start next timer</span></label>
        <label class="toggle-label"><input type="checkbox" id="focusModeToggle"><span>Focus Mode (hide non-essentials)</span></label>
        <label class="toggle-label"><input type="checkbox" id="breathingToggle" checked><span>Show breathing exercises during breaks</span></label>
      </div>
    </section>

    <section class="tips-section">
      <h2 class="tips-title">ğŸŒ± Quick Tips</h2>
      <ul class="tips-list">
        <li>Grow one habit at a time</li>
        <li>Nurture your focus zone</li>
        <li>Root out distractions</li>
      </ul>
    </section>
  </main>
</div>

<!-- Modals -->
<div class="modal" id="onboardingModal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">Welcome to Pomodoro Prime! ğŸŒ²</h2>
      <button class="modal-close" id="closeOnboarding">âœ•</button>
    </div>
    <div class="modal-body">
      <p>Your journey to focused productivity starts here. Start a session and watch your forest grow!</p>
      <div class="modal-footer">
        <button class="btn btn-primary" id="startJourneyBtn">Start My Journey</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="shortcutsModal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">âŒ¨ï¸ Keyboard Shortcuts</h2>
      <button class="modal-close" id="closeShortcuts">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="shortcuts-list">
        <div class="shortcut-item"><kbd class="key">Space</kbd><span class="shortcut-desc">Start / Pause</span></div>
        <div class="shortcut-item"><kbd class="key">R</kbd><span class="shortcut-desc">Reset Timer</span></div>
        <div class="shortcut-item"><kbd class="key">T</kbd><span class="shortcut-desc">Toggle Theme</span></div>
        <div class="shortcut-item"><kbd class="key">S</kbd><span class="shortcut-desc">Skip</span></div>
      </div>
    </div>
  </div>
</div>

<div class="modal achievement-modal" id="achievementModal" role="dialog" aria-modal="true">
  <div class="modal-content achievement-content">
    <div class="modal-header"><h2 class="modal-title">ğŸ† Achievement Unlocked!</h2><button class="modal-close" id="closeAchievement">âœ•</button></div>
    <div class="modal-body">
      <div class="achievement-icon" id="achievementIcon">ğŸŒŸ</div>
      <p class="achievement-name" id="achievementName">First Pomodoro</p>
      <p class="achievement-desc" id="achievementDesc">Complete your first focus session!</p>
      <div class="xp-gain" id="xpGain">+10 XP</div>
    </div>
  </div>
</div>

<script src="script.js" defer></script>
</body>
</html>